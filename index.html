<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Label Control</title>
  <style>
    :root{
      --bg1:#050913;
      --bg2:#0a1530;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.03);
      --stroke:rgba(255,255,255,.14);
      --stroke2:rgba(255,255,255,.08);
      --text:#e9eefc;
      --muted:rgba(233,238,252,.7);
      --accent:#2e6bff;
      --accent2:#1f52d6;
      --radius:18px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1100px 600px at 20% 0%, rgba(46,107,255,.25), transparent 60%),
        radial-gradient(900px 500px at 90% 20%, rgba(46,107,255,.18), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      padding:28px 18px 60px;
    }

    .wrap{
      max-width:1100px;
      margin:0 auto;
    }

    .shell{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border:1px solid var(--stroke2);
      border-radius:22px;
      padding:22px;
      box-shadow: 0 20px 70px rgba(0,0,0,.45);
    }

    h1{
      margin:0 0 10px;
      font-size:22px;
      letter-spacing:.2px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:18px;
      align-items:start;
    }

    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }

    .panel{
      background: var(--card);
      border:1px solid var(--stroke2);
      border-radius: var(--radius);
      padding:18px;
    }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 650px){
      .row{ grid-template-columns: 1fr; }
    }

    label{
      display:block;
      font-size:11px;
      letter-spacing:1.2px;
      text-transform:uppercase;
      color:var(--muted);
      margin:12px 0 6px;
    }

    input, select{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--stroke2);
      background: rgba(0,0,0,.25);
      color:var(--text);
      outline:none;
      font-size:14px;
    }

    input:focus, select:focus{
      border-color: rgba(46,107,255,.65);
      box-shadow: 0 0 0 3px rgba(46,107,255,.18);
    }

    .btns{
      display:flex;
      gap:10px;
      margin-top:14px;
      flex-wrap:wrap;
      align-items:center;
    }

    button{
      border:0;
      border-radius:999px;
      padding:10px 14px;
      font-weight:700;
      cursor:pointer;
      color:white;
      background: linear-gradient(180deg, var(--accent), var(--accent2));
      box-shadow: 0 10px 30px rgba(46,107,255,.25);
    }
    button.secondary{
      background: transparent;
      border:1px solid var(--stroke);
      color:var(--text);
      box-shadow:none;
    }
    button.danger{
      background: linear-gradient(180deg, #ff3c3c, #c81f1f);
      box-shadow: 0 10px 30px rgba(255,60,60,.18);
    }

    .help{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
    }

    /* Preview card */
    .previewCard{
      background: rgba(255,255,255,.04);
      border:1px solid var(--stroke2);
      border-radius: var(--radius);
      padding:18px;
    }

    .labelPreviewWrap{
      display:flex;
      justify-content:center;
      padding:18px 6px;
    }

    /* 4x6 label shown on screen scaled down */
    .labelPreview{
      width: 520px;         /* visual size only */
      height: 346px;        /* keeps 4:6 ratio (landscape preview) */
      background:#fff;
      border-radius:12px;
      box-shadow: 0 25px 60px rgba(0,0,0,.35);
      position:relative;
      overflow:hidden;
      padding: 18px 22px;
      color:#000;
    }

    @media (max-width: 980px){
      .labelPreview{ width:min(520px, 92vw); height:auto; aspect-ratio: 6 / 4; }
    }

    .brand{
      position:absolute;
      top:16px;
      left:22px;
      font-weight:900;
      letter-spacing:1.1px;
      font-size:14px; /* not tiny so it doesn't "bleed" */
      text-transform:uppercase;
    }

    .bigName{
      position:absolute;
      inset: 56px 26px 66px 26px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      font-weight:900;
      line-height:1.05;
      letter-spacing:.2px;
      font-size:86px;
      overflow:hidden;
      word-break: keep-all;
      overflow-wrap: break-word;
    }

    .footer{
      position:absolute;
      left:22px;
      right:22px;
      bottom:14px;
      display:flex;
      justify-content:space-between;
      gap:14px;
      font-weight:900;
      text-transform:uppercase;
      font-size:14px; /* thicker so thermal doesn't fuzz */
      letter-spacing:.8px;
    }

    .footer .right{
      text-align:right;
      flex: 0 0 auto;
      white-space:nowrap;
    }
    .footer .left{
      flex:1 1 auto;
      min-width:0;
    }

    .footer .orderLine{
      margin-top:6px;
      font-size:14px;
      letter-spacing:.7px;
      font-weight:900;
      display:none; /* enabled only if order present */
    }

    /* Admin */
    .adminBox{
      margin-top:16px;
      padding:14px;
      border-radius:14px;
      border:1px dashed rgba(255,255,255,.16);
      background: rgba(0,0,0,.18);
    }
    .adminControls{
      margin-top:12px;
      display:none;
    }
    .adminControls.show{ display:block; }

    .hint{
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
    }

    .adminRow{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:10px;
      align-items:end;
      margin-top:10px;
    }

    .smallNote{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="shell">
      <div class="grid">
        <!-- LEFT: CONTROLS -->
        <div class="panel">
          <h1>Label Control</h1>

          <label for="presetSelect">Customer Preset</label>
          <select id="presetSelect"></select>

          <label for="customerName">Customer Name</label>
          <input id="customerName" type="text" placeholder="Customer name..." autocomplete="off" />

          <div class="row">
            <div>
              <label for="orderNumber">Order # (optional)</label>
              <input id="orderNumber" type="text" placeholder="SO-12345" autocomplete="off" />
            </div>
            <div>
              <label for="totalPallets">Total Pallets (e.g. 12)</label>
              <input id="totalPallets" type="number" min="1" value="1" />
            </div>
          </div>

          <div class="row">
            <div>
              <label for="shipDate">Ship Date</label>
              <input id="shipDate" type="date" />
            </div>
            <div>
              <label for="startPallet">Start Pallet # (optional)</label>
              <input id="startPallet" type="number" min="1" value="1" />
            </div>
          </div>

          <div class="btns">
            <button id="printBtn">Print Pallet Labels</button>
            <button class="secondary" id="clearBtn" type="button">Clear</button>
          </div>

          <div class="smallNote">
            Prints <b>1 of N, 2 of N, …</b> on separate 4"×6" labels via <b>print.html</b>.
          </div>

          <!-- ADMIN -->
          <div class="adminBox">
            <label for="adminPass">Admin (manage presets)</label>
            <div class="adminRow">
              <input id="adminPass" type="password" placeholder="Enter password" />
              <button class="secondary" id="unlockBtn" type="button">Unlock</button>
            </div>
            <div class="hint">Hint: Hank Jung's 1st year working @ Apollon</div>

            <div id="adminControls" class="adminControls">
              <label for="newPreset">Add Preset</label>
              <div class="adminRow">
                <input id="newPreset" type="text" placeholder="New customer name" />
                <button id="addPresetBtn" type="button">Add</button>
              </div>

              <label for="deletePreset">Delete Preset</label>
              <div class="adminRow">
                <select id="deletePreset"></select>
                <button class="danger" id="deletePresetBtn" type="button">Delete</button>
              </div>
            </div>
          </div>
        </div>

        <!-- RIGHT: PREVIEW -->
        <div class="previewCard">
          <h1 style="margin-bottom:2px;">Preview</h1>
          <div class="help">This is a screen preview. Printing uses 4"×6" in <b>print.html</b>.</div>

          <div class="labelPreviewWrap">
            <div class="labelPreview" id="labelPreview">
              <div class="brand" id="prevBrand">APOLLON WIRE &amp; CABLE</div>

              <div class="bigName" id="prevName">ACE NJ</div>

              <div class="footer">
                <div class="left">
                  <div id="prevPallet">PALLET: 1 of 1</div>
                  <div class="orderLine" id="prevOrderLine">ORDER: <span id="prevOrder"></span></div>
                </div>
                <div class="right" id="prevShip">SHIP: 12/12/2025</div>
              </div>
            </div>
          </div>

          <div class="help">
            Tip: if your top-left brand text “bleeds”, keep it bold and not too small (this setup is optimized for thermal).
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- STORAGE ----------
    const LS_KEY = "apollon_customer_presets_v1";
    const DEFAULT_PRESETS = [
      "ACE NJ",
      "Turtle & Hughes",
      "Schwing Uniondale",
      "College Point"
    ];

    function loadPresets() {
      try {
        const raw = localStorage.getItem(LS_KEY);
        if (!raw) return [...DEFAULT_PRESETS];
        const arr = JSON.parse(raw);
        if (!Array.isArray(arr) || arr.length === 0) return [...DEFAULT_PRESETS];
        return arr.map(String).map(s => s.trim()).filter(Boolean);
      } catch {
        return [...DEFAULT_PRESETS];
      }
    }

    function savePresets(list) {
      localStorage.setItem(LS_KEY, JSON.stringify(list));
    }

    // ---------- ELEMENTS ----------
    const presetSelect = document.getElementById("presetSelect");
    const customerName = document.getElementById("customerName");
    const orderNumber = document.getElementById("orderNumber");
    const totalPallets = document.getElementById("totalPallets");
    const shipDate = document.getElementById("shipDate");
    const startPallet = document.getElementById("startPallet");

    const prevName = document.getElementById("prevName");
    const prevPallet = document.getElementById("prevPallet");
    const prevShip = document.getElementById("prevShip");
    const prevOrderLine = document.getElementById("prevOrderLine");
    const prevOrder = document.getElementById("prevOrder");

    const printBtn = document.getElementById("printBtn");
    const clearBtn = document.getElementById("clearBtn");

    // admin
    const adminPass = document.getElementById("adminPass");
    const unlockBtn = document.getElementById("unlockBtn");
    const adminControls = document.getElementById("adminControls");
    const newPreset = document.getElementById("newPreset");
    const addPresetBtn = document.getElementById("addPresetBtn");
    const deletePreset = document.getElementById("deletePreset");
    const deletePresetBtn = document.getElementById("deletePresetBtn");

    const ADMIN_PASSWORD = "2024";

    // ---------- HELPERS ----------
    function fmtShip(dateStr) {
      // expects YYYY-MM-DD; output MM/DD/YYYY
      if (!dateStr) return "";
      const [y,m,d] = dateStr.split("-");
      if (!y || !m || !d) return "";
      return `${m}/${d}/${y}`;
    }

    function setDefaultShipDateToday() {
      const today = new Date();
      const y = today.getFullYear();
      const m = String(today.getMonth()+1).padStart(2,"0");
      const d = String(today.getDate()).padStart(2,"0");
      shipDate.value = `${y}-${m}-${d}`;
    }

    function escapeParam(s) {
      return encodeURIComponent(String(s ?? "").trim());
    }

    function clampInt(val, fallback=1) {
      const n = parseInt(val, 10);
      return Number.isFinite(n) && n > 0 ? n : fallback;
    }

    // Auto-fit preview big name (keeps it readable, prevents overflow)
    function autoFitPreviewName() {
      const el = prevName;
      // reset to a big starting point
      el.style.fontSize = "92px";

      const maxH = el.clientHeight;
      const maxW = el.clientWidth;

      let size = 92;
      while (size >= 26) {
        el.style.fontSize = size + "px";
        // scrollWidth/Height includes overflow content
        if (el.scrollHeight <= maxH && el.scrollWidth <= maxW) break;
        size -= 2;
      }
    }

    function refreshPreview() {
      const name = customerName.value.trim() || "CUSTOMER NAME";
      prevName.textContent = name;

      const total = clampInt(totalPallets.value, 1);
      const start = clampInt(startPallet.value, 1);
      prevPallet.textContent = `PALLET: ${start} of ${total}`;

      const ship = fmtShip(shipDate.value) || "MM/DD/YYYY";
      prevShip.textContent = `SHIP: ${ship}`;

      const ord = orderNumber.value.trim();
      if (ord) {
        prevOrderLine.style.display = "block";
        prevOrder.textContent = ord;
      } else {
        prevOrderLine.style.display = "none";
        prevOrder.textContent = "";
      }

      autoFitPreviewName();
    }

    // ---------- PRESETS UI ----------
    let presets = loadPresets();

    function renderPresetDropdowns() {
      presetSelect.innerHTML = "";
      deletePreset.innerHTML = "";

      presets.forEach((p) => {
        const opt1 = document.createElement("option");
        opt1.value = p;
        opt1.textContent = p;
        presetSelect.appendChild(opt1);

        const opt2 = document.createElement("option");
        opt2.value = p;
        opt2.textContent = p;
        deletePreset.appendChild(opt2);
      });
    }

    function applySelectedPreset() {
      const val = presetSelect.value;
      if (val) {
        customerName.value = val;
        refreshPreview();
      }
    }

    // ---------- ADMIN ----------
    function tryUnlock() {
      if (adminPass.value.trim() === ADMIN_PASSWORD) {
        adminControls.classList.add("show");
        adminPass.value = "";
      } else {
        alert("Incorrect password.");
      }
    }

    unlockBtn.addEventListener("click", tryUnlock);
    adminPass.addEventListener("keydown", (e) => {
      if (e.key === "Enter") tryUnlock();
    });

    addPresetBtn.addEventListener("click", () => {
      const v = newPreset.value.trim();
      if (!v) return;

      if (!presets.includes(v)) {
        presets.push(v);
        presets.sort((a,b) => a.localeCompare(b));
        savePresets(presets);
        renderPresetDropdowns();
      }
      newPreset.value = "";
    });

    deletePresetBtn.addEventListener("click", () => {
      const v = deletePreset.value;
      if (!v) return;
      presets = presets.filter(x => x !== v);
      if (presets.length === 0) presets = [...DEFAULT_PRESETS];
      savePresets(presets);
      renderPresetDropdowns();
    });

    // ---------- PRINT ----------
    printBtn.addEventListener("click", () => {
      const name = customerName.value.trim();
      if (!name) {
        alert("Please enter a customer name.");
        return;
      }

      const order = orderNumber.value.trim();
      const total = clampInt(totalPallets.value, 1);
      const start = clampInt(startPallet.value, 1);
      const ship = shipDate.value; // YYYY-MM-DD

      // Open print.html with parameters
      const url =
        `print.html?customer=${escapeParam(name)}` +
        `&order=${escapeParam(order)}` +
        `&total=${escapeParam(total)}` +
        `&start=${escapeParam(start)}` +
        `&ship=${escapeParam(ship)}`;

      window.open(url, "_blank", "noopener,noreferrer");
    });

    clearBtn.addEventListener("click", () => {
      customerName.value = "";
      orderNumber.value = "";
      totalPallets.value = 1;
      startPallet.value = 1;
      setDefaultShipDateToday();
      refreshPreview();
    });

    // ---------- EVENTS ----------
    presetSelect.addEventListener("change", applySelectedPreset);

    [customerName, orderNumber, totalPallets, startPallet, shipDate].forEach(el => {
      el.addEventListener("input", refreshPreview);
      el.addEventListener("change", refreshPreview);
    });

    // ---------- INIT ----------
    renderPresetDropdowns();
    setDefaultShipDateToday();

    // Set default selection
    presetSelect.value = presets[0] || "";
    applySelectedPreset();
    refreshPreview();
    window.addEventListener("resize", autoFitPreviewName);
  </script>
</body>
</html>

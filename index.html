<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Label Control</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --bg:#0b1220;
      --panel:#0f1a2f;
      --panel2:#0b1326;
      --line:rgba(148,163,184,.22);
      --text:#f8fafc;
      --muted:rgba(248,250,252,.65);
      --accent:#3b82f6;
      --accent2:#2563eb;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(circle at top, #0f1a2f 0%, #050914 55%, #000 100%);
      color:var(--text);
      padding:28px 16px 60px;
      display:flex;
      justify-content:center;
    }

    .app{
      width:100%;
      max-width:1100px;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:18px;
      padding:22px;
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      backdrop-filter: blur(18px);
    }

    .layout{
      display:grid;
      grid-template-columns: minmax(320px, 1fr) minmax(360px, 1fr);
      gap:18px;
      align-items:start;
    }

    @media(max-width: 900px){
      .layout{ grid-template-columns: 1fr; }
    }

    h1{
      margin:0 0 14px;
      font-size:1.15rem;
      letter-spacing:.2px;
    }

    .field{
      margin-bottom:12px;
    }

    label{
      display:block;
      font-size:.72rem;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:var(--muted);
      margin:0 0 6px;
    }

    input, select{
      width:100%;
      border-radius:12px;
      border:1px solid rgba(148,163,184,.35);
      background: rgba(0,0,0,.25);
      color:var(--text);
      padding:10px 12px;
      outline:none;
      font-size:.95rem;
    }

    input:focus, select:focus{
      border-color: rgba(59,130,246,.9);
      box-shadow: 0 0 0 2px rgba(59,130,246,.22);
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }

    @media(max-width: 520px){
      .grid2{ grid-template-columns: 1fr; }
    }

    .actions{
      margin-top:12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    button{
      border:none;
      border-radius:999px;
      padding:10px 16px;
      font-weight:700;
      cursor:pointer;
      color:white;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 10px 26px rgba(37,99,235,.38);
    }

    button.secondary{
      background: transparent;
      border:1px solid rgba(148,163,184,.40);
      color:var(--text);
      box-shadow:none;
      font-weight:700;
    }

    .hint{
      margin-top:8px;
      font-size:.85rem;
      color:var(--muted);
    }

    /* Preview label */
    .previewWrap{
      display:flex;
      justify-content:center;
    }

    .labelPreview{
      width:100%;
      max-width:520px;
      aspect-ratio: 4 / 3; /* on-screen preview shape only */
      background:#fff;
      border-radius:12px;
      box-shadow: inset 0 0 0 1px #d1d5db, 0 18px 40px rgba(0,0,0,.35);
      padding:16px 18px;
      display:flex;
      flex-direction:column;
      gap:10px;
      overflow:hidden;
    }

    .lpHeader{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      font-size:14px;
      font-weight:800;
      letter-spacing:.08em;
      color:#111827;
      text-transform:uppercase;
    }

    .lpCenter{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:6px 10px;
      overflow:hidden;
    }

    .customerName{
      font-weight:900;
      color:#000;
      line-height:1.02;
      font-size:92px; /* will be auto-fit smaller */
      word-break: break-word;
      overflow:hidden;
      max-height:100%;
    }

    .lpFooter{
      display:flex;
      justify-content:space-between;
      gap:10px;
      font-size:18px;
      font-weight:900;
      letter-spacing:.02em;
      color:#000;
      text-transform:uppercase;
    }

    .lpFooter .small{
      font-size:18px;
      font-weight:900;
      letter-spacing:.02em;
    }

    .lpFooter .right{
      text-align:right;
    }

    .lpFooter .line{
      display:block;
      font-size:18px;
      font-weight:900;
      letter-spacing:.02em;
      white-space:nowrap;
    }

    /* Admin panel */
    .admin{
      margin-top:14px;
      border-top:1px solid rgba(148,163,184,.20);
      padding-top:14px;
    }

    .adminBox{
      margin-top:10px;
      padding:12px 12px 14px;
      border-radius:14px;
      border:1px dashed rgba(148,163,184,.35);
      background: rgba(0,0,0,.18);
    }

    .adminRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:end;
      margin-top:10px;
    }

    .adminRow .field{
      margin:0;
      flex:1;
      min-width:220px;
    }

    .adminRow button{
      padding:10px 14px;
      font-weight:800;
    }

    .danger{
      background: linear-gradient(135deg, #ef4444, #b91c1c);
      box-shadow:none;
    }

    .lockRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:end;
    }

    .lockRow .field{
      flex:1;
      min-width:260px;
      margin:0;
    }

    .unlockBtn{
      background: transparent;
      border:1px solid rgba(148,163,184,.45);
      color:var(--text);
      box-shadow:none;
      font-weight:900;
      padding:10px 14px;
    }

    .adminControls{
      display:none;
      margin-top:10px;
    }

    .adminControls.show{
      display:block;
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="card">
      <div class="layout">
        <!-- LEFT: controls -->
        <div>
          <h1>Label Control</h1>

          <div class="field">
            <label>Customer Preset</label>
            <select id="presetSelect"></select>
          </div>

          <div class="field">
            <label>Customer Name</label>
            <input id="customerInput" type="text" placeholder="Customer name" />
          </div>

          <div class="grid2">
            <div class="field">
              <label>Order # (Optional)</label>
              <input id="orderInput" type="text" placeholder="SO-12345" />
            </div>

            <div class="field">
              <label>Total Pallets (e.g. 12)</label>
              <input id="totalInput" type="number" min="1" step="1" value="1" />
            </div>
          </div>

          <div class="grid2">
            <div class="field">
              <label>Ship Date</label>
              <input id="shipInput" type="date" />
            </div>

            <div class="field">
              <label>Start Pallet # (Optional)</label>
              <input id="startInput" type="number" min="1" step="1" value="1" />
            </div>
          </div>

          <div class="actions">
            <button id="printBtn" type="button">Print Pallet Labels</button>
            <button id="clearBtn" type="button" class="secondary">Clear</button>
          </div>

          <div class="hint">Prints <b>1 of N, 2 of N, …</b> on separate labels via <code>print.html</code>.</div>

          <div class="admin">
            <div class="adminBox">
              <label>Admin (Manage Presets)</label>

              <div class="lockRow">
                <div class="field">
                  <input id="adminPass" type="password" placeholder="Enter password" />
                  <div class="hint">Hint: Hank Jung's 1st year working @ Apollon</div>
                </div>
                <button id="unlockBtn" type="button" class="unlockBtn">Unlock</button>
              </div>

              <div id="adminControls" class="adminControls">
                <div class="adminRow">
                  <div class="field">
                    <label>Add Preset</label>
                    <input id="addPresetInput" type="text" placeholder="New customer name" />
                  </div>
                  <button id="addPresetBtn" type="button">Add</button>
                </div>

                <div class="adminRow">
                  <div class="field">
                    <label>Delete Preset</label>
                    <select id="deletePresetSelect"></select>
                  </div>
                  <button id="deletePresetBtn" type="button" class="danger">Delete</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- RIGHT: preview -->
        <div class="previewWrap">
          <div class="labelPreview" aria-label="Label Preview">
            <div class="lpHeader">
              <div id="lpBrand">APOLLON WIRE &amp; CABLE</div>
              <!-- removed "STAGED ORDER" entirely -->
              <div></div>
            </div>

            <div class="lpCenter">
              <div id="lpCustomer" class="customerName">CUSTOMER</div>
            </div>

            <div class="lpFooter">
              <div class="small">
                <span id="lpOrderLine" class="line" style="display:none;">ORDER: <span id="lpOrder"></span></span>
                <span class="line">PALLET: <span id="lpPallet"></span></span>
              </div>
              <div class="right">
                <span class="line">SHIP: <span id="lpShip"></span></span>
              </div>
            </div>
          </div>
        </div>

      </div><!-- /layout -->
    </div><!-- /card -->
  </div><!-- /app -->

  <script>
    // ---------- Presets ----------
    const STORAGE_KEY = 'apollon_label_presets_v1';
    const DEFAULT_PRESETS = [
      'ACE NJ',
      'Mr. Supply',
      'Home Depot',
      'College Point',
      'Turtle & Hughes',
      'Schwing Uniondale'
    ];

    function loadPresets(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return [...DEFAULT_PRESETS];
        const arr = JSON.parse(raw);
        if(!Array.isArray(arr) || arr.length === 0) return [...DEFAULT_PRESETS];
        return arr.map(s => String(s)).filter(Boolean);
      }catch{
        return [...DEFAULT_PRESETS];
      }
    }

    function savePresets(list){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
    }

    function escapeParam(s){
      return encodeURIComponent(String(s ?? '').trim());
    }

    // ---------- Elements ----------
    const presetSelect = document.getElementById('presetSelect');
    const customerInput = document.getElementById('customerInput');
    const orderInput = document.getElementById('orderInput');
    const totalInput = document.getElementById('totalInput');
    const startInput = document.getElementById('startInput');
    const shipInput = document.getElementById('shipInput');

    const lpCustomer = document.getElementById('lpCustomer');
    const lpOrderLine = document.getElementById('lpOrderLine');
    const lpOrder = document.getElementById('lpOrder');
    const lpPallet = document.getElementById('lpPallet');
    const lpShip = document.getElementById('lpShip');

    const printBtn = document.getElementById('printBtn');
    const clearBtn = document.getElementById('clearBtn');

    // Admin
    const adminPass = document.getElementById('adminPass');
    const unlockBtn = document.getElementById('unlockBtn');
    const adminControls = document.getElementById('adminControls');
    const addPresetInput = document.getElementById('addPresetInput');
    const addPresetBtn = document.getElementById('addPresetBtn');
    const deletePresetSelect = document.getElementById('deletePresetSelect');
    const deletePresetBtn = document.getElementById('deletePresetBtn');

    // ---------- Preview Helpers ----------
    function formatShipDate(yyyy_mm_dd){
      if(!yyyy_mm_dd) return '';
      const [y,m,d] = yyyy_mm_dd.split('-').map(Number);
      if(!y || !m || !d) return '';
      const mm = String(m).padStart(2,'0');
      const dd = String(d).padStart(2,'0');
      return `${mm}/${dd}/${y}`;
    }

    function autoFitCustomerText(el){
      // shrink font until it fits in the preview box
      const maxPx = 96;      // start size
      const minPx = 34;      // don’t go smaller than this
      el.style.fontSize = maxPx + 'px';

      // force wrap nicely
      el.style.wordBreak = 'break-word';
      el.style.overflow = 'hidden';

      // available height is parent height
      const parent = el.parentElement;
      if(!parent) return;

      for(let size = maxPx; size >= minPx; size--){
        el.style.fontSize = size + 'px';
        if(el.scrollHeight <= parent.clientHeight && el.scrollWidth <= parent.clientWidth){
          break;
        }
      }
    }

    function updatePreview(){
      const customer = (customerInput.value || '').trim() || 'CUSTOMER';
      const order = (orderInput.value || '').trim();
      const total = Math.max(1, parseInt(totalInput.value || '1', 10));
      const start = Math.max(1, parseInt(startInput.value || '1', 10));
      const ship = formatShipDate(shipInput.value) || formatShipDate(new Date().toISOString().slice(0,10));

      lpCustomer.textContent = customer;
      autoFitCustomerText(lpCustomer);

      if(order){
        lpOrder.textContent = order;
        lpOrderLine.style.display = 'block';
      }else{
        lpOrder.textContent = '';
        lpOrderLine.style.display = 'none';
      }

      // preview shows first label number
      lpPallet.textContent = `${start} of ${total}`;
      lpShip.textContent = ship;
    }

    // ---------- Print ----------
    function openPrintWindow(){
      const customer = (customerInput.value || '').trim();
      if(!customer){
        alert('Please enter a customer name.');
        customerInput.focus();
        return;
      }

      const order = (orderInput.value || '').trim();
      const total = Math.max(1, parseInt(totalInput.value || '1', 10));
      const start = Math.max(1, parseInt(startInput.value || '1', 10));
      const ship = shipInput.value || new Date().toISOString().slice(0,10);

      // open print.html with query params
      const url =
        `print.html?customer=${escapeParam(customer)}` +
        `&order=${escapeParam(order)}` +
        `&total=${escapeParam(total)}` +
        `&start=${escapeParam(start)}` +
        `&ship=${escapeParam(ship)}`;

      window.open(url, '_blank');
    }

    // ---------- Preset UI ----------
    let presets = loadPresets();

    function rebuildPresetDropdowns(){
      presetSelect.innerHTML = '';
      deletePresetSelect.innerHTML = '';

      const placeholder = document.createElement('option');
      placeholder.value = '';
      placeholder.textContent = '-- Select customer --';
      presetSelect.appendChild(placeholder);

      presets.forEach(name=>{
        const opt = document.createElement('option');
        opt.value = name;
        opt.textContent = name;
        presetSelect.appendChild(opt);

        const opt2 = document.createElement('option');
        opt2.value = name;
        opt2.textContent = name;
        deletePresetSelect.appendChild(opt2);
      });
    }

    presetSelect.addEventListener('change', ()=>{
      if(presetSelect.value){
        customerInput.value = presetSelect.value;
        updatePreview();
      }
    });

    // ---------- Admin ----------
    function isCorrectPassword(p){
      // Hint: "Hank Jung's 1st year working @ Apollon"
      // If his first year is 2024, then password is likely: 2024
      // You can change this to whatever you want.
      return String(p).trim() === '2024';
    }

    unlockBtn.addEventListener('click', ()=>{
      if(isCorrectPassword(adminPass.value)){
        adminControls.classList.add('show');
      }else{
        alert('Incorrect password.');
      }
    });

    addPresetBtn.addEventListener('click', ()=>{
      const name = (addPresetInput.value || '').trim();
      if(!name) return;

      if(!presets.includes(name)){
        presets.push(name);
        presets.sort((a,b)=>a.localeCompare(b));
        savePresets(presets);
        rebuildPresetDropdowns();
      }
      addPresetInput.value = '';
    });

    deletePresetBtn.addEventListener('click', ()=>{
      const name = deletePresetSelect.value;
      if(!name) return;

      const keep = presets.filter(x => x !== name);
      if(keep.length === presets.length) return;

      presets = keep.length ? keep : [...DEFAULT_PRESETS];
      savePresets(presets);
      rebuildPresetDropdowns();
    });

    // ---------- Controls ----------
    printBtn.addEventListener('click', openPrintWindow);

    clearBtn.addEventListener('click', ()=>{
      presetSelect.value = '';
      customerInput.value = '';
      orderInput.value = '';
      totalInput.value = '1';
      startInput.value = '1';
      shipInput.value = new Date().toISOString().slice(0,10);
      updatePreview();
    });

    [customerInput, orderInput, totalInput, startInput, shipInput].forEach(el=>{
      el.addEventListener('input', updatePreview);
      el.addEventListener('change', updatePreview);
    });

    // Init
    rebuildPresetDropdowns();
    shipInput.value = new Date().toISOString().slice(0,10);
    updatePreview();
  </script>
</body>
</html>

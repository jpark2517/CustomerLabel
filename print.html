<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Print Labels</title>
  <style>
    /* Screen preview */
    html, body { margin: 0; padding: 0; background: #e5e7eb; }
    .page {
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 24px;
      box-sizing: border-box;
    }

    /* The label (LANDSCAPE 4x6) */
    .label {
      width: 6in;
      height: 4in;
      background: #fff;
      color: #111;
      border-radius: 16px;
      box-shadow: 0 18px 50px rgba(0,0,0,.25);
      box-sizing: border-box;
      padding: 0.35in 0.45in;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      overflow: hidden;
    }

    .top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
    }

    /* thicker + bigger so it doesn't "bleed" / break up */
    .brand {
      font-family: Arial, Helvetica, sans-serif;
      font-size: 14pt;
      font-weight: 800;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #000;
      line-height: 1;
      white-space: nowrap;
    }

    .customer-wrap{
      flex: 1;
      display: grid;
      place-items: center;
      padding: 0.15in 0.1in;
    }

    .customer-name{
      font-family: Arial, Helvetica, sans-serif;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 0.02em;
      text-align: center;
      line-height: 1.05;
      word-break: break-word;
      /* JS will auto-fit this */
      font-size: 72pt;
      max-width: 100%;
    }

    .footer{
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      gap: 12px;
      font-family: Arial, Helvetica, sans-serif;
      font-size: 14pt;   /* bigger so it prints clean */
      font-weight: 800;  /* thicker so it prints clean */
      color: #000;
    }

    .left-lines { display: grid; gap: 6px; }
    .muted { font-weight: 800; }
    .right { text-align: right; white-space: nowrap; }

    /* Print rules */
    @media print {
      @page { size: 6in 4in; margin: 0; } /* 4x6 landscape */
      html, body { margin: 0; padding: 0; background: #fff; }
      .page { padding: 0; min-height: auto; }

      .label {
        box-shadow: none;
        border-radius: 0;
        width: 6in;
        height: 4in;
        page-break-after: always;
      }

      /* Avoid Chrome adding a second page because of overflow */
      * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    }
  </style>
</head>

<body>
  <div id="printRoot"></div>

  <script>
    function getParam(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name) || "";
    }

    function formatShipDate(iso) {
      if (!iso) return "";
      // accepts YYYY-MM-DD
      const d = new Date(iso + "T00:00:00");
      if (Number.isNaN(d.getTime())) return iso;
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      const yy = d.getFullYear();
      return `${mm}/${dd}/${yy}`;
    }

    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[m]));
    }

    function autoFit(el) {
      const box = el.parentElement;
      let size = 96;      // start big
      const min = 28;     // don't go too small
      el.style.fontSize = size + "pt";

      while ((el.scrollWidth > box.clientWidth || el.scrollHeight > box.clientHeight) && size > min) {
        size -= 2;
        el.style.fontSize = size + "pt";
      }
    }

    function labelHTML({ customer, order, palletText, shipText }) {
      const orderLine = order ? `<div>ORDER: ${escapeHtml(order)}</div>` : "";
      const palletLine = palletText ? `<div>PALLET: ${escapeHtml(palletText)}</div>` : "";

      return `
        <div class="page">
          <div class="label">
            <div class="top">
              <div class="brand">APOLLON WIRE &amp; CABLE</div>
              <div></div>
            </div>

            <div class="customer-wrap">
              <div class="customer-name">${escapeHtml(customer || "CUSTOMER")}</div>
            </div>

            <div class="footer">
              <div class="left-lines">
                ${orderLine}
                ${palletLine}
              </div>
              <div class="right">
                ${shipText ? `SHIP: ${escapeHtml(shipText)}` : ""}
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function build() {
      const customer = getParam("customer") || "CUSTOMER";
      const order = getParam("order");
      const total = Math.max(1, parseInt(getParam("total") || "1", 10));
      const start = Math.max(1, parseInt(getParam("start") || "1", 10));
      const ship = getParam("ship");
      const shipText = formatShipDate(ship);

      const root = document.getElementById("printRoot");
      root.innerHTML = "";

      // Build N pages: "1 of 12", "2 of 12", etc.
      let html = "";
      for (let i = 0; i < total; i++) {
        const n = start + i;
        const palletText = `${n} of ${total}`;
        html += labelHTML({ customer, order, palletText, shipText });
      }
      root.innerHTML = html;

      // Auto-fit each customer name
      root.querySelectorAll(".customer-name").forEach(autoFit);
    }

    window.addEventListener("DOMContentLoaded", () => {
      build();
      // Print after layout is ready
      requestAnimationFrame(() => requestAnimationFrame(() => window.print()));
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Print Labels</title>

  <style>
    /* FORCE label size in code: 4" x 6" (portrait) */
    @media print{
      @page{
        size: 4in 6in;
        margin: 0;
      }
      html, body{
        margin:0 !important;
        padding:0 !important;
        background:#fff !important;
      }
    }

    html, body{
      margin:0;
      padding:0;
      background:#fff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:#000;
    }

    /* Each label is EXACTLY one page */
    .page{
      width: 4in;
      height: 6in;
      page-break-after: always;
      display:flex;
      align-items:stretch;
      justify-content:stretch;
      background:#fff;
    }
    .page:last-child{ page-break-after: auto; }

    .label{
      width:100%;
      height:100%;
      padding: 0.35in 0.35in; /* whitespace around content */
      display:flex;
      flex-direction:column;
    }

    .top{
      display:flex;
      justify-content:flex-start;
      align-items:flex-start;
      min-height: 0.35in;
    }

    /* BOLDER so thermal doesn’t break up */
    .brand{
      font-size: 18pt;
      font-weight: 900;
      letter-spacing: .14em;
      text-transform: uppercase;
      white-space:nowrap;
    }

    .main{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      overflow:hidden;
      padding: 0.1in 0.05in;
    }

    .customer{
      font-weight: 900;
      line-height: .95;
      font-size: 120pt; /* JS auto-fits down */
      max-width: 100%;
      max-height: 100%;
      overflow:hidden;
      word-break: break-word;
    }

    .bottom{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:10px;
      min-height: 0.45in;
      white-space:nowrap;
    }

    .meta{
      font-size: 18pt;     /* larger to avoid “thin bleed” */
      font-weight: 900;
      letter-spacing: .03em;
      text-transform: uppercase;
    }

    .order{
      margin-top: 0.12in;
      font-size: 18pt;
      font-weight: 900;
      letter-spacing: .03em;
      text-transform: uppercase;
      white-space:nowrap;
    }

    /* No accidental dark backgrounds */
    *{ background: transparent; }
  </style>
</head>
<body>

  <div id="printLabels"></div>

<script>
  function getParam(k){
    const u = new URL(window.location.href);
    return u.searchParams.get(k) || "";
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }

  function formatShipDate(iso){
    if(!iso) return "--/--/----";
    const [y,m,d] = iso.split("-");
    if(!y || !m || !d) return "--/--/----";
    return `${m}/${d}/${y}`;
  }

  function makeLabelHTML({ customer, order, palletText, shipText }){
    const orderLine = order
      ? `<div class="order">ORDER: ${escapeHtml(order)}</div>`
      : ``;

    return `
      <div class="page">
        <div class="label">
          <div class="top">
            <div class="brand">APOLLON WIRE &amp; CABLE</div>
          </div>

          <div class="main">
            <div class="customer">${escapeHtml(customer)}</div>
          </div>

          <div class="bottom">
            <div class="meta">PALLET: ${escapeHtml(palletText)}</div>
            <div class="meta">SHIP: ${escapeHtml(shipText)}</div>
          </div>

          ${orderLine}
        </div>
      </div>
    `;
  }

  function autoFitText(el){
    // shrink customer name until it fits the page area
    let size = 120;     // pt
    const min = 34;     // pt
    el.style.fontSize = size + "pt";

    while(size > min && (el.scrollHeight > el.clientHeight || el.scrollWidth > el.clientWidth)){
      size -= 2;
      el.style.fontSize = size + "pt";
    }
  }

  function buildPrintPages(){
    const customer = getParam("customer") || "CUSTOMER";
    const order = getParam("order");
    const total = Math.max(1, parseInt(getParam("total") || "1", 10));
    const start = Math.max(1, parseInt(getParam("start") || "1", 10));
    const shipText = formatShipDate(getParam("ship"));

    const container = document.getElementById("printLabels");
    container.innerHTML = "";

    const pages = [];
    for(let i=0;i<total;i++){
      const n = start + i;
      pages.push(makeLabelHTML({
        customer,
        order,
        palletText: `${n} OF ${total}`,
        shipText
      }));
    }
    container.innerHTML = pages.join("");

    // auto-fit after DOM paints
    requestAnimationFrame(()=>{
      container.querySelectorAll(".customer").forEach(el=>autoFitText(el));
    });
  }

  window.addEventListener("DOMContentLoaded", ()=>{
    buildPrintPages();
    // print once it’s built
    setTimeout(()=>window.print(), 50);
  });
</script>

</body>
</html>
